---
title: "Plots comparison"
author: "Miriam Kretschmer"
date: "7/5/2022"
output:
  bookdown::html_document2:
    code_folding: hide
bibliography: citations.bib
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r, results='hide'}
#setwd("/mnt/bohacek/kathi/miriam/accessibilty_sperm_embryo")

suppressPackageStartupMessages(library(rtracklayer))
suppressPackageStartupMessages(library(GenomicRanges))
suppressPackageStartupMessages(library(epiwraps))
```

# Introduction

k-means clustering did not give conclusive results. So here, the subsets created in [Data subsets.Rmd][link1] are used to display regions accessible in one cell type and not in another across the other cell types.

```{r tracks}
tracks <- c(
  sperm1="/mnt/bohacek/kathi/fromLiterature/ATAC_PE/tracks/ATAC_PRJNA480448_Sperm_GSM3262855.bw",
  sperm2="/mnt/bohacek/kathi/fromLiterature/ATAC_PE/tracks/ATAC_PRJNA480448_Sperm_GSM3262856.bw",
  sperm3="/mnt/bohacek/kathi/fromLiterature/ATAC_PE/tracks/ATAC_PRJNA315208_Sperm_GSM2088378.bw",
  rs1="/mnt/bohacek/kathi/fromLiterature/ATAC_SE/tracks/ATACse_PRJNA399533_RoundSpermatides_GSM2751133.bw",
  rs2="/mnt/bohacek/kathi/fromLiterature/ATAC_SE/tracks/ATACse_PRJNA399533_RoundSpermatides_GSM2751134.bw",
  ps1="/mnt/bohacek/kathi/fromLiterature/ATAC_SE/tracks/ATACse_PRJNA399533_PachytenSpermatocytes_GSM2751129.bw",
  ps2="/mnt/bohacek/kathi/fromLiterature/ATAC_SE/tracks/ATACse_PRJNA399533_PachytenSpermatocytes_GSM2751130.bw",
  ds1="/mnt/bohacek/kathi/fromLiterature/ATAC_SE/tracks/ATACse_PRJNA399533_cKitposSpermatogonia_GSM2751125.bw",
  ds2="/mnt/bohacek/kathi/fromLiterature/ATAC_SE/tracks/ATACse_PRJNA399533_cKitposSpermatogonia_GSM2751126.bw",
  uds1="/mnt/bohacek/kathi/fromLiterature/ATAC_SE/tracks/ATACse_PRJNA399533_Thy1posSpermatogonia_GSM2751121.bw",
  uds2="/mnt/bohacek/kathi/fromLiterature/ATAC_SE/tracks/ATACse_PRJNA399533_Thy1posSpermatogonia_GSM2751122.bw",
  mIIoocyte1="/mnt/bohacek/kathi/fromLiterature/ATAC_PE/tracks/ATAC_PRJNA480448_MIIoocyte_GSM3262863.bw",
  sperm1_RNAPIIS5p="/mnt/bohacek/kathi/fromLiterature/spermChIPs/tracks/ChIP_PRJNA480447_Sperm_GSM3262865.bw",
  sperm2_RNAPIIS5p="/mnt/bohacek/kathi/fromLiterature/spermChIPs/tracks/ChIP_PRJNA480447_Sperm_GSM3262866.bw",
  sperm1_RNAPIIS2p="/mnt/bohacek/kathi/fromLiterature/spermChIPs/tracks/ChIP_PRJNA480447_Sperm_GSM3262867.bw",
  sperm2_RNAPIIS2p="/mnt/bohacek/kathi/fromLiterature/spermChIPs/tracks/ChIP_PRJNA480447_Sperm_GSM3262868.bw",
  rs_RNAPolII="/mnt/bohacek/kathi/fromLiterature/ChIP_SE/tracks/SRR792837.bw"
)
```



# Comparisons

## Sperm vs Round spermatids

__Sperm peaks__

```{r sperm, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions"}
peaks <- readRDS("rds_saves/peaks/consensus_peaks/consensus.peaks_sperm.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
norm_factor <- readRDS("rds_saves/norm_factor_all_noGVoocyte.rds")
m <- rescaleSignalMatrices(m, norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from sperm", trim = 0.99, raster_resize_mat = TRUE)
```

```{r sperm-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks from sperm", trim = 0.99, raster_resize_mat = TRUE)
```

__Round spermatid peaks__

```{r rs, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions"}
peaks <- readRDS("rds_saves/peaks/consensus_peaks/consensus.peaks_rs.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```

```{r rs-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks from round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```

__Regions in sperm that are also accessible in round spermatids__

```{r sperm-also-rs, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions that are also accessible in round spermatids"}
peaks <- readRDS("rds_saves/peaks/subsets/consensus/overlaps_sperm_rs.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from sperm \n also accessible \n in round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```

```{r sperm-also-rs-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions that are also accessible in round spermatids"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks from sperm \n also accessible \n in round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```

__Regions in round spermatids that are also accessible in sperm__

```{r rs-also-sperm2, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions that are also accessible in sperm", eval=FALSE}
peaks <- readRDS("rds_saves/peaks/subsets/consensus/overlaps_rs_sperm.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from round spermatids \n also accessible \n in sperm", trim = 0.99, raster_resize_mat = TRUE)
```
```{r rs-also-sperm, fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions that are also accessible in sperm", eval=TRUE}
knitr::include_graphics("plots/peaks rs also sperm.png")
```

```{r rs-also-sperm-fused2, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions that are also accessible in sperm", eval=FALSE}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks from round spermatids \n also accessible \n in sperm", trim = 0.99, raster_resize_mat = TRUE)
```
```{r rs-also-sperm-fused, fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions that are also accessible in sperm", eval=TRUE}
knitr::include_graphics("plots/peaks rs also sperm fused.png")
```


__Regions accessible in both sperm and round spermatids__

```{r sperm-and-rs, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at peak regions accessible in both sperm and round spermatids"}
peaks <- readRDS("rds_saves/peaks/subsets/consensus/intersects/intersects_sperm_rs.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from sperm and \n round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```

```{r sperm-and-rs-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at peak regions accessible in both sperm and round spermatids"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks from sperm and \n round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```


__Regions accessible in sperm that are not accessible in round spermatids__

```{r sperm-not-rs, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak not accessible in round spermatids"}
#peaks <- readRDS("rds_saves/peaks/subsets/consensus/overlaps_sperm_not_rs.rds")
#m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
#m <- rescaleSignalMatrices(m, norm_factor)
#plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from sperm not \n round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```



__Sperm regions not accessible in the MII stage oocyte__

```{r GRE-sperm-not-mIIoocyte, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions not accessible in the oocyte"}
peaks <- readRDS("rds_saves/peaks/subsets/consensus/overlaps_sperm_not_MIIoocyte.rds")
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from sperm \n and not MIIoocytes", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-sperm-not-mIIoocyte-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions not accessible in the oocyte"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from sperm \n and not MIIoocytes", trim = 0.99, raster_resize_mat = TRUE)
```














### GRE

__Sperm peaks__

```{r GRE-sperm, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE"}
peaks <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_sperm.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
norm_factor <- readRDS("rds_saves/norm_factor_all_noGVoocyte_GRE.rds")
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from sperm with GRE", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-sperm-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks from sperm with GRE", trim = 0.99, raster_resize_mat = TRUE)
```

```{r, results='hide'}
sperm_peaks <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_sperm.rds")
rs_peaks <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_rs.rds")
ps_peaks <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_ps.rds")
ds_peaks <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_ds.rds")
uds_peaks <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_uds.rds")
MIIoocyte_peaks <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_mIIoocytes.rds")

length(peaks)
o <- overlapsAny(peaks, rs_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```
Out of `r length(peaks)` accessible regions in sperm, there are only `r length(o)` regions also accessible in round spermatids.
Out of `r length(peaks)` accessible regions in sperm, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions in sperm, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions in sperm, there are only `r length(r)` regions also accessible in undifferentiated spermatogonia.
Out of `r length(peaks)` accessible regions in sperm, there are only `r length(s)` regions also accessible in MIIoocytes.



__Round spermatid peaks__

```{r GRE-rs, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions with GRE"}
peaks <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_rs.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from round spermatids with GRE", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-rs-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks from round spermatids with GRE", trim = 0.99, raster_resize_mat = TRUE)
```


```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, sperm_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions in round spermatids, there are only `r length(o)` regions also accessible in sperm.
Out of `r length(peaks)` accessible regions in round spermatids, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions in round spermatids, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions in round spermatids, there are only `r length(r)` regions also accessible in undifferentiated spermatogonia.
Out of `r length(peaks)` accessible regions in round spermatids, there are only `r length(s)` regions also accessible in MIIoocytes.


__Regions in sperm that are also accessible in round spermatids__

```{r GRE-sperm-and-rs, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are also accessible in round spermatids with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_sperm_GRE_rs_GRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from sperm \n also accessible \n in round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-sperm-and-rs-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are also accessible in round spermatids with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from sperm \n also accessible \n in round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```


__Regions in round spermatids that are also accessible in sperm__

```{r GRE-rs-and-sperm, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions with GRE that are also accessible in sperm with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_rs_GRE_sperm_GRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from \n round spermatids also \n accessible sperm", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-rs-and-sperm-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions with GRE that are also accessible in sperm with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from \n round spermatids also \n accessible sperm", trim = 0.99, raster_resize_mat = TRUE)
```



__Regions accessible in round spermatids with GRE and in sperm with GRE__

```{r GRE-sperm-also-rs, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at regions with GRE that are accessible in sperm with GRE and round spermatids with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/intersects/intersects_sperm_GRE_rs_GRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from sperm \n and from round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-sperm-also-rs-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at regions with GRE that are accessible in sperm with GRE and round spermatids with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from sperm \n and from round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```

```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, sperm_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` regions accessible in sperm and round spermatids, there are `r length(o)` regions also accessible in round spermatids.
Out of `r length(peaks)` regions accessible in sperm and round spermatids, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` regions accessible in sperm and round spermatids, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` regions accessible in sperm and round spermatids, there are only `r length(r)` regions also accessible in undifferentiated spermatogonia.
Out of `r length(peaks)` regions accessible in sperm and round spermatids, there are only `r length(s)` regions also accessible in MIIoocytes.

__Regions in sperm that are not accessible in round spermatids__

```{r GRE-sperm-not-rs, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are not accessible in round spermatids with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_spermGRE_not_rsGRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from sperm \n and not round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-sperm-not-rs-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are not accessible in round spermatids with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from sperm \n and not round spermatids", trim = 0.99, raster_resize_mat = TRUE)
```


```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, rs_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions of sperm not accessible  in round spermatids, there are `r length(o)` regions also accessible round spermatids.
Out of `r length(peaks)` accessible regions of sperm not accessible  in round spermatids, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions of sperm not accessible  in round spermatids, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions of sperm not accessible  in round spermatids, there are only `r length(r)` regions also accessible in undifferentiated spermatogonia.
Out of `r length(peaks)` accessible regions of sperm not accessible  in round spermatids, there are only `r length(s)` regions also accessible in MIIoocytes.


__Regions in round spermatids that are not accessible in sperm__

```{r GRE-rs-not-sperm, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatids peak regions with GRE that are not accessible in sperm with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_rsGRE_not_spermGRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from \n round spermatids \n and not sperm", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-rs-not-sperm-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at round spermatid peak regions with GRE that are not accessible in sperm with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from \n round spermatids \n and not sperm", trim = 0.99, raster_resize_mat = TRUE)
```


```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, sperm_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions of round spermatids not accessible  in sperm, there are `r length(o)` regions also accessible in sperm.
Out of `r length(peaks)` accessible regions of round spermatids not accessible  in sperm, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions of round spermatids not accessible  in sperm, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions of round spermatids not accessible  in sperm, there are only `r length(r)` regions also accessible in undifferentiated spermatogonia.
Out of `r length(peaks)` accessible regions of round spermatids not accessible  in sperm, there are only `r length(s)` regions also accessible in MIIoocytes.









## Sperm and MII stage oocyte

__MII stage oocyte__

```{r GRE-mIIoocyte, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at MIIoocyte peak regions"}
peaks <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_mIIoocytes.rds")
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE MIIoocytes", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-mIIoocyte-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at MII oocytes peak regions with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from MIIoocytes", trim = 0.99, raster_resize_mat = TRUE)
```

```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, sperm_peaks)
o <- peaks[o==TRUE]
length(o)

o2 <- overlapsAny(peaks, sperm_peaks)
o2 <- peaks[o2==TRUE]
length(o2)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions of MIIoocytes, there are `r length(o)` regions also accessible in sperm.
Out of `r length(peaks)` accessible regions of MIIoocytes, there are `r length(o2)` regions also accessible in round spermatids.
Out of `r length(peaks)` accessible regions of MIIoocytes, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions of MIIoocytes, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions of MIIoocytes, there are only `r length(r)` regions also accessible in undifferentiated spermatogonia.
Out of `r length(peaks)` accessible regions of MIIoocytes, there are only `r length(s)` regions also accessible in MIIoocytes.


__Regions in sperm that are also accessible in MII oocytes__

```{r GRE-sperm-and-mIIoocyte, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are also accessible in MII oocytes with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_sperm_GRE_MIIoocyte_GRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from sperm \n also accessible in MIIoocytes", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-sperm-and-mIIoocyte-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are also accessible in MII oocytes with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from sperm \n also accessible in MIIoocytes", trim = 0.99, raster_resize_mat = TRUE)
```

__Regions in MII oocytes that are also accessible in sperm__

```{r GRE-mIIoocytes-also-sperm, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at MIIoocyte peak regions with GRE that are also accessible in sperm with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_MIIoocyte_GRE_sperm_GRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from MIIoocytes \n also accessible in sperm", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-mIIoocytes-also-sperm-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at MIIoocyte peak regions with GRE that are also accessible in sperm with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from MIIoocytes \n also accessible in sperm", trim = 0.99, raster_resize_mat = TRUE)
```

__Regions accessible in MII oocytes and sperm__

```{r GRE-sperm-and-MIIoocyte, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at peak regions with GRE accessible in both sperm and MIIoocytes"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/intersects/intersects_sperm_GRE_MIIoocyte_GRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from MIIoocytes \n and sperm with GRE", trim = 0.99, raster_resize_mat = TRUE)
```


```{r GRE-sperm-and-MIIoocyte-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at peak regions with GRE accessible in both sperm and MIIoocytes"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks from MIIoocytes \n and sperm with GRE", trim = 0.99, raster_resize_mat = TRUE)
```

```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, rs_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` regions accessible in sperm and MIIoocytes, there are `r length(o)` regions also accessible in round spermatids.
Out of `r length(peaks)` regions accessible in sperm and MIIoocytes, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` regions accessible in sperm and MIIoocytes, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` regions accessible in sperm and MIIoocytes, there are only `r length(r)` regions also accessible in undifferentiated spermatogonia.
Out of `r length(peaks)` regions accessible in sperm and MIIoocytes, there are only `r length(s)` regions also accessible in MIIoocytes.



__Regions in sperm that are not accessible in MIIoocytes__

```{r GRE-sperm-not-MIIoocyte, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are not accessible in MIIoocytes with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_spermGRE_not_MIIoocyteGRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from sperm with GRE \n not accessible in MIIoocytes", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-sperm-not-MIIoocyte-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are not accessible in MIIoocytes with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks from sperm with GRE \n not accessible in MIIoocytes", trim = 0.99, raster_resize_mat = TRUE)
```


```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, rs_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` regions accessible in sperm not accessible in MIIoocytes, there are `r length(o)` regions also accessible in round spermatids.
Out of `r length(peaks)` regions accessible in sperm not accessible in MIIoocytes, there are `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` regions accessible in sperm not accessible in MIIoocytes, there are `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` regions accessible in sperm not accessible in MIIoocytes, there are `r length(r)` regions also accessible in undifferentiated spermatogonia.
Out of `r length(peaks)` regions accessible in sperm not accessible in MIIoocytes, there are `r length(s)` regions also accessible in MIIoocytes.


__Regions in MIIoocytes that are not accessible in sperm__

```{r GRE-mIIoocyte-not-sperm, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at MIIoocyte peak regions with GRE that are not accessible in sperm with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_MIIoocyteGRE_not_spermGRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from MIIoocyte \n not accessible in sperm", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-mIIoocyte-not-sperm-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at MIIoocyte peak regions with GRE that are not accessible in sperm with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from MIIoocyte \n not accessible in sperm", trim = 0.99, raster_resize_mat = TRUE)
```

There seems to be a big overlap between sperm and undifferentiated spermatogonia, see Figure \@ref(fig:GRE-sperm-not-MIIoocyte-fused) and between MII oocytes and undifferentiated spermatogonia, see Figure  \@ref(fig:GRE-mIIoocyte-not-sperm-fused).


```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, rs_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions in MIIoocytes not accessible in sperm, there are `r length(o)` regions also accessible in round spermatids.
Out of `r length(peaks)` accessible regions in MIIoocytes not accessible in sperm, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions in MIIoocytes not accessible in sperm, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions in MIIoocytes not accessible in sperm, there are only `r length(r)` regions also accessible in undifferentiated spermatogonia.
Out of `r length(peaks)` accessible regions in MIIoocytes not accessible in sperm, there are only `r length(s)` regions also accessible in MIIoocytes.




## Undifferentiated spermatogonia

__undifferentiated spermatogonia peaks__

```{r GRE-uds, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at undifferentiated spermatogonia peak regions with GRE"}
peaks <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_uds.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks from undifferentiated \n spermatogonia with GRE", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-uds-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at undifferentiated spermatogonia peak regions with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks from undifferentiated \n spermatogonia with GRE", trim = 0.99, raster_resize_mat = TRUE)
```


```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, sperm_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, rs_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions in undifferentiated spermatogonia, there are only `r length(o)` regions also accessible in sperm.
Out of `r length(peaks)` accessible regions in undifferentiated spermatogonia, there are only `r length(r)` regions also accessible in round spermatids.
Out of `r length(peaks)` accessible regions in undifferentiated spermatogonia, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions in undifferentiated spermatogonia, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions in undifferentiated spermatogonia, there are only `r length(s)` regions also accessible in MIIoocytes.


__Regions in sperm that are also accessible in undifferentiated spermatogonia__

```{r GRE-sperm-and-uds, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are also accessible in undifferentiated spermatogonia with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_sperm_GRE_uds_GRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from sperm \n also accessible in \n undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-sperm-and-uds-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are also accessible in undifferentiated spermatogonia with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from sperm \n also accessible in \n undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```


__Regions in undifferentiated spermatogonia that are also accessible in sperm__

```{r GRE-uds-and-sperm, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at undifferentiated spermatogonia peak regions with GRE that are also accessible in sperm with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_uds_GRE_sperm_GRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from \n undifferentiated spermatogonia \n also accessible in sperm", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-uds-and-sperm-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at undifferentiated spermatogonia peak regions with GRE that are also accessible in sperm with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from \n undifferentiated spermatogonia \n also accessible in sperm", trim = 0.99, raster_resize_mat = TRUE)
```


__Regions accessible in undifferentiated spermatogonia with GRE and in sperm with GRE__

```{r GRE-sperm-also-uds, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at regions with GRE that are accessible in sperm with GRE and undifferentiated spermatogonia with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/intersects/intersects_sperm_GRE_rs_GRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE form sperm \n and from undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-sperm-also-uds-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at regions with GRE that are accessible in sperm with GRE and undifferentiated spermatogonia with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE form sperm \n and from undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```

```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, sperm_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, rs_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` regions accessible in sperm and undifferentiated spermatogonia, there are `r length(o)` regions also accessible in sperm.
Out of `r length(peaks)` regions accessible in sperm and undifferentiated spermatogonia, there are only `r length(r)` regions also accessible in round spermatids.
Out of `r length(peaks)` regions accessible in sperm and undifferentiated spermatogonia, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` regions accessible in sperm and undifferentiated spermatogonia, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` regions accessible in sperm and undifferentiated spermatogonia, there are only `r length(s)` regions also accessible in MIIoocytes.

__Regions in sperm that are not accessible in undifferentiated spermatogonia__

```{r GRE-sperm-not-uds, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are not accessible in undifferentiated spermatogonia with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_spermGRE_not_udsGRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from sperm \n and not undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-sperm-not-uds-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are not accessible in undifferentiated spermatogonia with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from sperm \n and not undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```


```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, rs_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions of sperm not accessible  in undifferentiated spermatogonia, there are `r length(o)` regions also accessible round spermatids.
Out of `r length(peaks)` accessible regions of sperm not accessible  in undifferentiated spermatogonia, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions of sperm not accessible  in undifferentiated spermatogonia, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions of sperm not accessible  in undifferentiated spermatogonia, there are only `r length(r)` regions also accessible in undifferentiated spermatogonia.
Out of `r length(peaks)` accessible regions of sperm not accessible  in undifferentiated spermatogonia, there are only `r length(s)` regions also accessible in MIIoocytes.

There is signal in the UDS sample that should not be there according to overlap. Maybe deducting not the consensus peaks but both UDS samples helps:

```{r GRE-sperm-not-uds-substract, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are not accessible in undifferentiated spermatogonia with GRE", eval=FALSE}
peaks1 <- import("/mnt/bohacek/kathi/fromLiterature/ATAC_SE/peaks/ATACse_PRJNA399533_Thy1posSpermatogonia_GSM2751121_peaks.broadPeak")
peaks2 <- import("/mnt/bohacek/kathi/fromLiterature/ATAC_SE/peaks/ATACse_PRJNA399533_Thy1posSpermatogonia_GSM2751122_peaks.broadPeak")

allpeaks <- c(peaks1, peaks2)
UDS_GRE <- reduce(allpeaks, with.revmap=TRUE)
sperm_GRE <- readRDS("rds_saves/peaks/GRE_peaks/peaks_with_GRE_sperm.rds")
peaks <- overlapsAny(sperm_GRE, UDS_GRE)
peaks <- sperm_GRE[peaks==FALSE]
#saveRDS(o, "rds_saves/peaks/subsets/GRE/overlaps_spermGRE_not_udsGRE.rds")
length(peaks)

m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from sperm \n and not undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```
```{r GRE-sperm-not-uds-substract2, fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are not accessible in undifferentiated spermatogonia with GRE", eval=TRUE}
knitr::include_graphics("plots/sperm not UDS deducting all UDS.png")
```


```{r GRE-sperm-not-uds-fused-substract, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions with GRE that are not accessible in undifferentiated spermatogonia with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from sperm \n and not undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```

Deducting both UDS peaks from the sperm peaks slightly reduces the unexpected signal, although not  fully. It could be that some regions did not pass the threshold of peak calling and hence were not substracted when  creating the subset, but are still slightly accessible so that the signal  in the plot is created.


__Regions in undifferentiated spermatogonia that are not accessible in sperm__

```{r GRE-uds-not-sperm, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at undifferentiated spermatogonia peak regions with GRE that are not accessible in sperm with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_udsGRE_not_spermGRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from \n undifferentiated spermatogonia \n and not sperm", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-uds-not-sperm-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at undifferentiated spermatogonia peak regions with GRE that are not accessible in sperm with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from \n undifferentiated spermatogonia \n and not sperm", trim = 0.99, raster_resize_mat = TRUE)
```


```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, sperm_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, rs_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions of undifferentiated spermatogonia not accessible  in sperm, there are `r length(o)` regions also accessible in sperm.
Out of `r length(peaks)` accessible regions of undifferentiated spermatogonia not accessible  in sperm, there are only `r length(r)` regions also accessible in round spermatids.
Out of `r length(peaks)` accessible regions of undifferentiated spermatogonia not accessible  in sperm, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions of undifferentiated spermatogonia not accessible  in sperm, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions of undifferentiated spermatogonia not accessible  in sperm, there are only `r length(s)` regions also accessible in MIIoocytes.


There seem to be many regions exclusively accessible in sperm (Figure \@ref(fig:GRE-sperm-not-uds-fused)). On the other hand, there is a portion of regions from undifferentiated spermatogonia not accessible in sperm that overlap with MIIoocytes.

__Regions accessible in undifferentiated spermatogonia with GRE and in MIIoocytes with GRE__

```{r GRE-MIIoocyte-also-uds, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at regions with GRE that are accessible in MIIoocyte with GRE and undifferentiated spermatogonia with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/intersects/intersects_uds_GRE_MIIoocyte_GRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE form MIIoocyte \n and from undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-MIIoocyte-also-uds-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at regions with GRE that are accessible in MIIoocyte with GRE and undifferentiated spermatogonia with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE form MIIoocyte \n and from undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```

```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, sperm_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, rs_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` regions accessible in MIIoocyte and undifferentiated spermatogonia, there are `r length(o)` regions also accessible in sperm.
Out of `r length(peaks)` regions accessible in MIIoocyte and undifferentiated spermatogonia, there are only `r length(r)` regions also accessible in round spermatids.
Out of `r length(peaks)` regions accessible in MIIoocyte and undifferentiated spermatogonia, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` regions accessible in MIIoocyte and undifferentiated spermatogonia, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` regions accessible in MIIoocyte and undifferentiated spermatogonia, there are only `r length(s)` regions also accessible in MIIoocytes.

__Regions in MIIoocyte that are not accessible in undifferentiated spermatogonia__

```{r GRE-MIIoocyte-not-uds, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at MIIoocyte peak regions with GRE that are not accessible in undifferentiated spermatogonia with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_MIIoocyteGRE_not_udsGRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from MIIoocyte \n and not undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-MIIoocyte-not-uds-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at MIIoocyte peak regions with GRE that are not accessible in undifferentiated spermatogonia with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from MIIoocyte \n and not undifferentiated spermatogonia", trim = 0.99, raster_resize_mat = TRUE)
```


```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, rs_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, sperm_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions of MIIoocyte not accessible  in undifferentiated spermatogonia, there are only `r length(r)` regions also accessible in sperm.
Out of `r length(peaks)` accessible regions of MIIoocyte not accessible  in undifferentiated spermatogonia, there are `r length(o)` regions also accessible round spermatids.
Out of `r length(peaks)` accessible regions of MIIoocyte not accessible  in undifferentiated spermatogonia, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions of MIIoocyte not accessible  in undifferentiated spermatogonia, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions of MIIoocyte not accessible  in undifferentiated spermatogonia, there are only `r length(s)` regions also accessible in MIIoocytes.


__Regions in undifferentiated spermatogonia that are not accessible in MIIoocyte__

```{r GRE-uds-not-MIIoocyte, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at undifferentiated spermatogonia peak regions with GRE that are not accessible in MIIoocyte with GRE"}
peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_udsGRE_not_MIIoocyteGRE.rds")
m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
m <- rescaleSignalMatrices(m, 1/norm_factor)
plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from \n undifferentiated spermatogonia \n and not MIIoocyte", trim = 0.99, raster_resize_mat = TRUE)
```

```{r GRE-uds-not-MIIoocyte-fused, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at undifferentiated spermatogonia peak regions with GRE that are not accessible in MIIoocyte with GRE"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from \n undifferentiated spermatogonia \n and not MIIoocytes", trim = 0.99, raster_resize_mat = TRUE)
```


```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, sperm_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, rs_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions of undifferentiated spermatogonia not accessible  in MIIoocytes, there are only `r length(r)` regions also accessible in sperm.
Out of `r length(peaks)` accessible regions of undifferentiated spermatogonia  in MIIoocytes, there are `r length(o)` regions also accessible round spermatids.
Out of `r length(peaks)` accessible regions of undifferentiated spermatogonia  in MIIoocytes, there are only `r length(p)` regions also accessible in pachytene spermatocytes.
Out of `r length(peaks)` accessible regions of undifferentiated spermatogonia  in MIIoocytes, there are only `r length(q)` regions also accessible in differentiated spermatogonia.
Out of `r length(peaks)` accessible regions of undifferentiated spermatogonia  in MIIoocytes, there are only `r length(s)` regions also accessible in MIIoocytes.



## Immature male germ cells

__Regions in sperm that are not accessible in immature male germ cells__

```{r GRE-sperm-not-immaturegermcells2, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions that are not accessible in immature male germ cells, eval=FALSE"}
#peaks <- readRDS("rds_saves/peaks/subsets/GRE/overlaps_spermGRE_not_immatureGermCellsGRE.rds")
#m <- signal2Matrix(tracks[1:12], peaks, w=20, BPPARAM = 4)
#m <- rescaleSignalMatrices(m, 1/norm_factor)
#plotEnrichedHeatmaps(lapply(m,log1p), row_title="Peaks with GRE from sperm \n not accessible \n in immature germ cells", trim = 0.99, raster_resize_mat = TRUE)
```
```{r GRE-sperm-not-immaturegermcells, fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions that are not accessible in immature male germ cells", eval=TRUE}
knitr::include_graphics("plots/sperm not immature male germ cells GRE peaks malefemale.png")
```

```{r GRE-sperm-not-immaturegermcells-fused2, eval=FALSE, results='hide', fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions that are not accessible in immature male germ cells"}
fused_sperm_mat <- mergeSignalMatrices(m[1:3])
fused_rs_mat <- mergeSignalMatrices(m[4:5])
fused_ps_mat <- mergeSignalMatrices(m[6:7])
fused_ds_mat <- mergeSignalMatrices(m[8:9])
fused_uds_mat <- mergeSignalMatrices(m[10:11])

fused_m <- c(list(fused_sperm=fused_sperm_mat), list(fused_rs=fused_rs_mat), list(fused_ps=fused_ps_mat), list(fused_ds=fused_ds_mat), list(fused_uds=fused_uds_mat), m[-1:-11])
plotEnrichedHeatmaps(lapply(fused_m,log1p), row_title="Peaks with GRE from sperm \n not accessible \n in immature germ cells", trim = 0.99, raster_resize_mat = TRUE)
```
```{r GRE-sperm-not-immaturegermcells-fused, fig.height=5, fig.width=15, fig.cap="Accessibility of male and female germ cells at sperm peak regions that are not accessible in immature male germ cells", eval=TRUE}
knitr::include_graphics("plots/sperm not immature male germ cells GRE peaks malefemale fused.png")
```

Interestingly, there are no accessible sites in MII oocytes in sperm peak regions that are not accessible in immature male germ cells, see Figure \@ref(fig:GRE-sperm-not-immaturegermcells-fused).

```{r, results='hide'}
length(peaks)
o <- overlapsAny(peaks, rs_peaks)
o <- peaks[o==TRUE]
length(o)

p <- overlapsAny(peaks, ps_peaks)
p <- peaks[p==TRUE]
length(p)

q <- overlapsAny(peaks, ds_peaks)
q <- peaks[q==TRUE]
length(q)

r <- overlapsAny(peaks, uds_peaks)
r <- peaks[r==TRUE]
length(r)

s <- overlapsAny(peaks, MIIoocyte_peaks)
s <- peaks[s==TRUE]
length(s)
```

Out of `r length(peaks)` accessible regions in sperm that are not accessible in immature male germ cells, there are only `r length(o)` regions also accessible round spermatids. 
Out of `r length(peaks)` accessible regions in sperm that are not accessible in immature male germ cells, there are only `r length(o)` regions also accessible pachytene spermatids.
Out of `r length(peaks)` accessible regions in sperm that are not accessible in immature male germ cells, there are only `r length(o)` regions also accessible differentiating spermatogonia. 
Out of `r length(peaks)` accessible regions in sperm that are not accessible in immature male germ cells, there are only `r length(o)` regions also accessible undifferentiated spermatogonia. 
Indeed, out of `r length(peaks)` accessible regions in sperm that are not accessible in immature male germ cells, there are only `r length(o)` regions also accessible MIIoocytes. 

This means there are about 7000 regions exclusively accessible in mature sperm.



```{r}
sessionInfo()
```

[link1]: https://github.com/kretschmermiriam/materials2022/blob/main/Project%20-%20Accessibility%20across%20male%20and%20female%20germline/Data-subsets.html
